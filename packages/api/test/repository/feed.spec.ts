import { FeedRepository } from '../../src/repository/Feed'
import { FeedsState } from '../../src/repository/feedState'
import { FeedInfo, Network } from '../../types'

describe('FeedRepository', () => {
  const legacyFeeds: Array<FeedInfo> = [
    {
      feedFullName: 'arbitrum-one_eth-usd_6',
      isRouted: false,
      id: 'Price-ETH/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xf56E739C436EA6e65A17DBfaC9D7E57062D19422',
      network: 'arbitrum-one' as Network,
      networkName: 'Arbitrum ONE',
      chain: 'Arbitrum',
      name: 'eth/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#E84142',
      blockExplorer: 'https://arbiscan.io/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    {
      feedFullName: 'elastos-mainnet_bnb-usd_6',
      isRouted: true,
      id: 'Price-BNB/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x0Aa147F25CE8BfaA4E6B4B2CCa91f595bD732CD4',
      network: 'elastos-mainnet' as Network,
      networkName: 'Elastos Mainnet',
      chain: 'Elastos',
      name: 'bnb/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://esc.elastos.io/address/{address}',
      deviation: null,
      heartbeat: null,
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    {
      feedFullName: 'kcc-mainnet_usdt-usd_6',
      isRouted: false,
      id: 'Price-USDT/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xD39D4d972C7E166856c4eb29E54D3548B4597F53',
      network: 'kcc-mainnet' as Network,
      networkName: 'KCC Mainnet',
      chain: 'KCC',
      name: 'usdt/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#ff0066',
      blockExplorer: 'https://scan.kcc.io/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    {
      feedFullName: 'polygon-mainnet_btc-usd_6',
      isRouted: false,
      id: 'Price-BTC/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x3806311c7138ddF2bAF2C2093ff3633E5A73AbD4',
      network: 'polygon-mainnet' as Network,
      networkName: 'Polygon Mainnet',
      chain: 'Polygon',
      name: 'btc/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://polygonscan.com/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    {
      feedFullName: 'polygon-mainnet_dai-usd_6',
      isRouted: false,
      id: 'Price-DAI/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x3806311c7138ddF2bAF2C2093ff3633E5A73AbD4',
      network: 'polygon-mainnet' as Network,
      networkName: 'Polygon Mainnet',
      chain: 'Polygon',
      name: 'dai/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://polygonscan.com/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    {
      feedFullName: 'polygon-zkevm-mainnet_usdc-usd_6',
      isRouted: false,
      id: 'Price-USDC/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xb99FA0430C73E7B82604Aa99d351d6aFdCe46A16',
      network: 'polygon-zkevm-mainnet' as Network,
      networkName: 'Polygon zkEVM Mainnet',
      chain: 'Polygon',
      name: 'usdc/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://zkevm.polygonscan.com/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    {
      feedFullName: 'reef-mainnet_reef-usdt_6',
      isRouted: false,
      id: 'Price-REEF/USDT-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x828D7517D9Cf0d99f952d709371117ef8825e81B',
      network: 'reef-mainnet' as Network,
      networkName: 'Reef Mainnet',
      chain: 'Reef',
      name: 'reef/usdt',
      label: '₮',
      pollingPeriod: 180000,
      color: '#66ff00',
      blockExplorer: 'https://reefscan.com/contract/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
  ]
  const legacyFeed = {
    feedFullName: 'scroll-mainnet_usdc-usd_6',
    isRouted: false,
    id: 'Price-USDC/USD-6',
    address: '0x0000000000000000000000000000000000000000',
    contractId: '0x0000000000000000000000000000000000000000',
    routerAddress: '0x0d13c6058DDE86da77565ED6038C065Af71e9208',
    network: 'scroll-mainnet' as Network,
    networkName: 'Scroll Mainnet',
    chain: 'Scroll',
    name: 'usdc/usd',
    label: '$',
    pollingPeriod: 120000,
    color: '#66ff00',
    blockExplorer: 'https://scrollscan.com/address/{address}',
    deviation: '0.2',
    heartbeat: '86400000',
    finality: '900000',
    routerAbi: [],
    abi: [],
  }
  const v2Feeds: Array<FeedInfo> = [
    {
      feedFullName: 'arbitrum-sepolia_eth-usd_6',
      id: '0x3d15f701',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'arbitrum-sepolia' as Network,
      name: 'eth/usd',
      networkName: 'Arbitrum Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x3d15f701',
      chain: 'Arbitrum',
      blockExplorer: 'https://sepolia.arbiscan.io/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    {
      feedFullName: 'base-sepolia_eth-usd_6',
      id: '0x3d15f701',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia' as Network,
      name: 'eth/usd',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x3d15f701',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    {
      feedFullName: 'base-sepolia_usdt-usd_6',
      id: '0x538f5a25',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia' as Network,
      name: 'usdt/usd',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x538f5a25',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    {
      feedFullName: 'base-sepolia_wit-usdt_6',
      id: '0xde55fdb1',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia' as Network,
      name: 'wit/usdt',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '₮',
      contractId: '0xde55fdb1',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '1',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
  ]
  const v2Feed = {
    feedFullName: 'celo-alfajores_btc-usd_6',
    id: '0x24beead4',
    abi: [],
    routerAbi: [],
    address: null,
    routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
    isRouted: false,
    network: 'celo-alfajores' as Network,
    name: 'btc/usd',
    networkName: 'Celo Alfajores',
    pollingPeriod: 120000,
    label: '$',
    contractId: '0x24beead4',
    chain: 'Celo',
    blockExplorer: 'https://alfajores.celoscan.io/address/{address}',
    deviation: '3.5',
    heartbeat: '86400000',
    finality: '900000',
    color: '#66ff00',
  }
  const baseConfigFullName = {
    'arbitrum-one_eth-usd_6': {
      feedFullName: 'arbitrum-one_eth-usd_6',
      isRouted: false,
      id: 'Price-ETH/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xf56E739C436EA6e65A17DBfaC9D7E57062D19422',
      network: 'arbitrum-one',
      networkName: 'Arbitrum ONE',
      chain: 'Arbitrum',
      name: 'eth/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#E84142',
      blockExplorer: 'https://arbiscan.io/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'elastos-mainnet_bnb-usd_6': {
      feedFullName: 'elastos-mainnet_bnb-usd_6',
      isRouted: true,
      id: 'Price-BNB/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x0Aa147F25CE8BfaA4E6B4B2CCa91f595bD732CD4',
      network: 'elastos-mainnet',
      networkName: 'Elastos Mainnet',
      chain: 'Elastos',
      name: 'bnb/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://esc.elastos.io/address/{address}',
      deviation: null,
      heartbeat: null,
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'kcc-mainnet_usdt-usd_6': {
      feedFullName: 'kcc-mainnet_usdt-usd_6',
      isRouted: false,
      id: 'Price-USDT/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xD39D4d972C7E166856c4eb29E54D3548B4597F53',
      network: 'kcc-mainnet',
      networkName: 'KCC Mainnet',
      chain: 'KCC',
      name: 'usdt/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#ff0066',
      blockExplorer: 'https://scan.kcc.io/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'polygon-mainnet_btc-usd_6': {
      feedFullName: 'polygon-mainnet_btc-usd_6',
      isRouted: false,
      id: 'Price-BTC/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x3806311c7138ddF2bAF2C2093ff3633E5A73AbD4',
      network: 'polygon-mainnet',
      networkName: 'Polygon Mainnet',
      chain: 'Polygon',
      name: 'btc/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://polygonscan.com/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'polygon-mainnet_dai-usd_6': {
      feedFullName: 'polygon-mainnet_dai-usd_6',
      isRouted: false,
      id: 'Price-DAI/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x3806311c7138ddF2bAF2C2093ff3633E5A73AbD4',
      network: 'polygon-mainnet',
      networkName: 'Polygon Mainnet',
      chain: 'Polygon',
      name: 'dai/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://polygonscan.com/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'polygon-zkevm-mainnet_usdc-usd_6': {
      feedFullName: 'polygon-zkevm-mainnet_usdc-usd_6',
      isRouted: false,
      id: 'Price-USDC/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xb99FA0430C73E7B82604Aa99d351d6aFdCe46A16',
      network: 'polygon-zkevm-mainnet',
      networkName: 'Polygon zkEVM Mainnet',
      chain: 'Polygon',
      name: 'usdc/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://zkevm.polygonscan.com/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'reef-mainnet_reef-usdt_6': {
      feedFullName: 'reef-mainnet_reef-usdt_6',
      isRouted: false,
      id: 'Price-REEF/USDT-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x828D7517D9Cf0d99f952d709371117ef8825e81B',
      network: 'reef-mainnet',
      networkName: 'Reef Mainnet',
      chain: 'Reef',
      name: 'reef/usdt',
      label: '₮',
      pollingPeriod: 180000,
      color: '#66ff00',
      blockExplorer: 'https://reefscan.com/contract/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'arbitrum-sepolia_eth-usd_6': {
      feedFullName: 'arbitrum-sepolia_eth-usd_6',
      id: '0x3d15f701',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'arbitrum-sepolia',
      name: 'eth/usd',
      networkName: 'Arbitrum Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x3d15f701',
      chain: 'Arbitrum',
      blockExplorer: 'https://sepolia.arbiscan.io/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    'base-sepolia_eth-usd_6': {
      feedFullName: 'base-sepolia_eth-usd_6',
      id: '0x3d15f701',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia',
      name: 'eth/usd',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x3d15f701',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    'base-sepolia_usdt-usd_6': {
      feedFullName: 'base-sepolia_usdt-usd_6',
      id: '0x538f5a25',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia',
      name: 'usdt/usd',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x538f5a25',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    'base-sepolia_wit-usdt_6': {
      feedFullName: 'base-sepolia_wit-usdt_6',
      id: '0xde55fdb1',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia',
      name: 'wit/usdt',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '₮',
      contractId: '0xde55fdb1',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '1',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
  }
  const updatedConfig = {
    'arbitrum-one_eth-usd_6': {
      feedFullName: 'arbitrum-one_eth-usd_6',
      isRouted: false,
      id: 'Price-ETH/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xf56E739C436EA6e65A17DBfaC9D7E57062D19422',
      network: 'arbitrum-one',
      networkName: 'Arbitrum ONE',
      chain: 'Arbitrum',
      name: 'eth/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#E84142',
      blockExplorer: 'https://arbiscan.io/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'elastos-mainnet_bnb-usd_6': {
      feedFullName: 'elastos-mainnet_bnb-usd_6',
      isRouted: true,
      id: 'Price-BNB/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x0Aa147F25CE8BfaA4E6B4B2CCa91f595bD732CD4',
      network: 'elastos-mainnet',
      networkName: 'Elastos Mainnet',
      chain: 'Elastos',
      name: 'bnb/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://esc.elastos.io/address/{address}',
      deviation: null,
      heartbeat: null,
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'kcc-mainnet_usdt-usd_6': {
      feedFullName: 'kcc-mainnet_usdt-usd_6',
      isRouted: false,
      id: 'Price-USDT/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xD39D4d972C7E166856c4eb29E54D3548B4597F53',
      network: 'kcc-mainnet',
      networkName: 'KCC Mainnet',
      chain: 'KCC',
      name: 'usdt/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#ff0066',
      blockExplorer: 'https://scan.kcc.io/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'polygon-mainnet_btc-usd_6': {
      feedFullName: 'polygon-mainnet_btc-usd_6',
      isRouted: false,
      id: 'Price-BTC/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x3806311c7138ddF2bAF2C2093ff3633E5A73AbD4',
      network: 'polygon-mainnet',
      networkName: 'Polygon Mainnet',
      chain: 'Polygon',
      name: 'btc/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://polygonscan.com/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'polygon-mainnet_dai-usd_6': {
      feedFullName: 'polygon-mainnet_dai-usd_6',
      isRouted: false,
      id: 'Price-DAI/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x3806311c7138ddF2bAF2C2093ff3633E5A73AbD4',
      network: 'polygon-mainnet',
      networkName: 'Polygon Mainnet',
      chain: 'Polygon',
      name: 'dai/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://polygonscan.com/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'polygon-zkevm-mainnet_usdc-usd_6': {
      feedFullName: 'polygon-zkevm-mainnet_usdc-usd_6',
      isRouted: false,
      id: 'Price-USDC/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0xb99FA0430C73E7B82604Aa99d351d6aFdCe46A16',
      network: 'polygon-zkevm-mainnet',
      networkName: 'Polygon zkEVM Mainnet',
      chain: 'Polygon',
      name: 'usdc/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://zkevm.polygonscan.com/address/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'reef-mainnet_reef-usdt_6': {
      feedFullName: 'reef-mainnet_reef-usdt_6',
      isRouted: false,
      id: 'Price-REEF/USDT-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x828D7517D9Cf0d99f952d709371117ef8825e81B',
      network: 'reef-mainnet',
      networkName: 'Reef Mainnet',
      chain: 'Reef',
      name: 'reef/usdt',
      label: '₮',
      pollingPeriod: 180000,
      color: '#66ff00',
      blockExplorer: 'https://reefscan.com/contract/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'scroll-mainnet_usdc-usd_6': {
      feedFullName: 'scroll-mainnet_usdc-usd_6',
      isRouted: false,
      id: 'Price-USDC/USD-6',
      address: '0x0000000000000000000000000000000000000000',
      contractId: '0x0000000000000000000000000000000000000000',
      routerAddress: '0x0d13c6058DDE86da77565ED6038C065Af71e9208',
      network: 'scroll-mainnet',
      networkName: 'Scroll Mainnet',
      chain: 'Scroll',
      name: 'usdc/usd',
      label: '$',
      pollingPeriod: 120000,
      color: '#66ff00',
      blockExplorer: 'https://scrollscan.com/address/{address}',
      deviation: '0.2',
      heartbeat: '86400000',
      finality: '900000',
      routerAbi: [],
      abi: [],
    },
    'arbitrum-sepolia_eth-usd_6': {
      feedFullName: 'arbitrum-sepolia_eth-usd_6',
      id: '0x3d15f701',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'arbitrum-sepolia',
      name: 'eth/usd',
      networkName: 'Arbitrum Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x3d15f701',
      chain: 'Arbitrum',
      blockExplorer: 'https://sepolia.arbiscan.io/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    'base-sepolia_eth-usd_6': {
      feedFullName: 'base-sepolia_eth-usd_6',
      id: '0x3d15f701',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia',
      name: 'eth/usd',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x3d15f701',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    'base-sepolia_usdt-usd_6': {
      feedFullName: 'base-sepolia_usdt-usd_6',
      id: '0x538f5a25',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia',
      name: 'usdt/usd',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x538f5a25',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '0.1',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    'base-sepolia_wit-usdt_6': {
      feedFullName: 'base-sepolia_wit-usdt_6',
      id: '0xde55fdb1',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'base-sepolia',
      name: 'wit/usdt',
      networkName: 'Base Sepolia',
      pollingPeriod: 120000,
      label: '₮',
      contractId: '0xde55fdb1',
      chain: 'Base',
      blockExplorer: 'https://base-sepolia.blockscout.com/{address}',
      deviation: '1',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
    'celo-alfajores_btc-usd_6': {
      feedFullName: 'celo-alfajores_btc-usd_6',
      id: '0x24beead4',
      abi: [],
      routerAbi: [],
      address: null,
      routerAddress: '0x1111AbA2164AcdC6D291b08DfB374280035E1111',
      isRouted: false,
      network: 'celo-alfajores',
      name: 'btc/usd',
      networkName: 'Celo Alfajores',
      pollingPeriod: 120000,
      label: '$',
      contractId: '0x24beead4',
      chain: 'Celo',
      blockExplorer: 'https://alfajores.celoscan.io/address/{address}',
      deviation: '3.5',
      heartbeat: '86400000',
      finality: '900000',
      color: '#66ff00',
    },
  }

  it('Updates config by fullname map after updating the legacy and v2 feeds from the repository', async () => {
    const feedState = new FeedsState()

    feedState.setLegacyFeeds(legacyFeeds)
    feedState.setV2Feeds(v2Feeds)

    const feedRepository = new FeedRepository(feedState)

    expect(baseConfigFullName).toStrictEqual(
      feedRepository.getConfigByFullName(),
    )

    feedRepository.setLegacyFeeds([...legacyFeeds, legacyFeed])
    feedRepository.setV2Feeds([...v2Feeds, v2Feed])

    expect(updatedConfig).toStrictEqual(feedRepository.getConfigByFullName())
    expect(updatedConfig).not.toStrictEqual(baseConfigFullName)
  })

  it('Updates config by fullname map after updating the legacy and v2 feeds from the feed state and then calling initialize', async () => {
    const feedState = new FeedsState()

    feedState.setLegacyFeeds(legacyFeeds)
    feedState.setV2Feeds(v2Feeds)

    const feedRepository = new FeedRepository(feedState)

    expect(baseConfigFullName).toStrictEqual(
      feedRepository.getConfigByFullName(),
    )

    feedState.setLegacyFeeds([...legacyFeeds, legacyFeed])
    feedState.setV2Feeds([...v2Feeds, v2Feed])
    feedRepository.initialize()

    expect(updatedConfig).toStrictEqual(feedRepository.getConfigByFullName())
    expect(updatedConfig).not.toStrictEqual(baseConfigFullName)
  })
})
